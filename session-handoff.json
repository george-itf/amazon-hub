{
  "project": "Amazon Hub Brain",
  "description": "Operational console for Invicta Tools (UK) - inventory, orders, BOMs, and profitability tracking",
  "tech_stack": {
    "frontend": "React + Vite + Shopify Polaris UI",
    "backend": "Express.js",
    "database": "Supabase (PostgreSQL)"
  },
  "branch": "claude/session-handoff-tracking-p9O7Q",
  "last_commit": "0b32f57 - Comprehensively enhance all operational pages with advanced features",

  "completed_work": [
    {
      "feature": "Historical Order Import",
      "files": ["server/routes/shopify.js"],
      "description": "Import historical orders from Shopify API"
    },
    {
      "feature": "Profitability Analytics",
      "files": ["server/routes/analytics.js", "client/src/pages/ProfitPage.jsx", "client/src/utils/api.jsx"],
      "description": "Comprehensive profit tracking with margins, fees, trends"
    },
    {
      "feature": "Enhanced AuditPage",
      "files": ["client/src/pages/AuditPage.jsx"],
      "description": "Date range filters with presets, event detail modal with before/after diff viewer, statistics sidebar, entity history"
    },
    {
      "feature": "Enhanced Dashboard",
      "files": ["client/src/pages/Dashboard.jsx"],
      "description": "Performance tab with analytics, mini sparkline charts, critical state banners, today's performance sidebar"
    },
    {
      "feature": "Enhanced ReviewPage",
      "files": ["client/src/pages/ReviewPage.jsx"],
      "description": "Keyboard shortcuts (j/k/g/G/Enter/r/s/?), stats cards by reason, searchable BOM selection, filter by reason, tabbed shortcuts help"
    },
    {
      "feature": "Enhanced ComponentsPage",
      "files": ["client/src/pages/ComponentsPage.jsx"],
      "description": "Detail modal with stock movement history, inventory stats with health progress bar, sorting options, stock value calculations"
    },
    {
      "feature": "Enhanced BundlesPage",
      "files": ["client/src/pages/BundlesPage.jsx"],
      "description": "Availability calculations (limiting component detection), cost calculations, availability filtering, progress bar, detailed modal with can-build quantities"
    },
    {
      "feature": "Enhanced ListingsPage",
      "files": ["client/src/pages/ListingsPage.jsx"],
      "description": "Statistics tab with coverage metrics, source breakdown, top BOMs table, source filtering, sorting, enhanced detail modal"
    },
    {
      "feature": "Comprehensive Code Audit & Security Fixes",
      "files": [
        "server/index.js",
        "server/routes/analytics.js",
        "server/routes/audit.js",
        "server/routes/keepa.js",
        "server/services/audit.js",
        "server/services/shopify.js",
        "server/services/googleAuth.js",
        "client/src/utils/api.jsx",
        "client/src/pages/BundlesPage.jsx"
      ],
      "description": "Full codebase audit with 171 issues identified. Fixed: missing return statements, added auth to audit routes, security headers (CSP/HSTS), error handler hardening, graceful shutdown with timeout, request timeouts, N+1 query batching, input validation, frontend performance optimizations"
    }
  ],

  "key_patterns": {
    "price_format": "Prices stored in pence, displayed as Â£X.XX using formatPrice(pence)",
    "filtering": "All pages use useMemo for filtered data with search, status, and type filters",
    "modals": "Detail modals use selectedItem state pattern with Modal component",
    "api": "API functions in client/src/utils/api.jsx, routes in server/routes/"
  },

  "key_files": {
    "frontend_pages": "client/src/pages/*.jsx",
    "api_client": "client/src/utils/api.jsx",
    "backend_routes": "server/routes/*.js",
    "backend_services": "server/services/*.js",
    "main_server": "server/index.js"
  },

  "database_tables": [
    "components", "boms", "bom_components", "inventory",
    "orders", "order_items", "review_queue", "listing_memory",
    "stock_movements", "system_events", "audit_log"
  ],

  "recent_audit": {
    "date": "2026-01-14",
    "issues_found": 171,
    "critical_fixed": 5,
    "high_fixed": 10,
    "categories": [
      "Security headers (CSP, HSTS, Referrer-Policy)",
      "Authentication on audit routes",
      "Error handler hardening",
      "Request timeouts (30s default)",
      "Graceful shutdown with timeout",
      "Input validation for services",
      "N+1 query optimizations",
      "Frontend performance (useMemo/useCallback)"
    ]
  },

  "status": "Comprehensive code audit completed. All critical and high priority issues fixed."
}
